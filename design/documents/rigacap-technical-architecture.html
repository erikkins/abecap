<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RigaCap â€” Technical Architecture Document</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');

  :root {
    --navy: #172554;
    --navy-mid: #1e3a5f;
    --navy-light: #1e40af;
    --gold: #f59e0b;
    --gold-light: #fbbf24;
    --gold-pale: #fef3c7;
    --green: #22c55e;
    --green-light: #dcfce7;
    --red: #ef4444;
    --dark: #111827;
    --gray: #64748b;
    --light-gray: #f8fafc;
    --border: #e2e8f0;
    --code-bg: #0f172a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    color: var(--dark);
    line-height: 1.6;
    background: #fff;
  }

  @page {
    size: letter;
    margin: 0.5in 0.6in;
  }

  @media print {
    body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .page-break { page-break-before: always; }
    .no-break { page-break-inside: avoid; }
  }

  /* Cover */
  .cover {
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    background: linear-gradient(145deg, #0c1a3a 0%, var(--navy) 40%, #0f2847 100%);
    color: #fff;
    padding: 4rem;
    position: relative;
    overflow: hidden;
  }

  /* Subtle grid pattern */
  .cover::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image:
      linear-gradient(rgba(245,158,11,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(245,158,11,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
  }
  .cover::after {
    content: '';
    position: absolute;
    top: -30%; right: -20%;
    width: 60%; height: 80%;
    background: radial-gradient(circle, rgba(245,158,11,0.08) 0%, transparent 70%);
    border-radius: 50%;
  }

  .cover * { position: relative; z-index: 1; }

  /* Gold corners */
  .cover-corners { position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 1; }
  .cover-corners::before, .cover-corners::after {
    content: ''; position: absolute;
    width: 60px; height: 60px;
    border-color: var(--gold); border-style: solid;
  }
  .cover-corners::before { top: 40px; left: 40px; border-width: 2px 0 0 2px; }
  .cover-corners::after { top: 40px; right: 40px; border-width: 2px 2px 0 0; }
  .cover-corners-bottom { position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 1; }
  .cover-corners-bottom::before, .cover-corners-bottom::after {
    content: ''; position: absolute;
    width: 60px; height: 60px;
    border-color: var(--gold); border-style: solid;
  }
  .cover-corners-bottom::before { bottom: 40px; left: 40px; border-width: 0 0 2px 2px; }
  .cover-corners-bottom::after { bottom: 40px; right: 40px; border-width: 0 2px 2px 0; }

  .cover .doc-type {
    font-size: 0.75rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--gold);
    font-weight: 600;
    margin-bottom: 1rem;
    padding: 4px 16px;
    border: 1px solid rgba(245,158,11,0.3);
    border-radius: 4px;
  }
  .cover .logo {
    font-size: 1.1rem;
    letter-spacing: 0.35em;
    text-transform: uppercase;
    font-weight: 600;
    color: rgba(255,255,255,0.6);
    margin-bottom: 2rem;
  }
  .cover .logo .beacon {
    display: inline-block;
    width: 8px; height: 8px;
    background: var(--gold);
    border-radius: 50%;
    margin-right: 8px;
    vertical-align: middle;
    box-shadow: 0 0 12px rgba(245,158,11,0.6);
  }
  .cover h1 {
    font-size: 2.8rem;
    font-weight: 800;
    line-height: 1.15;
    margin-bottom: 1.5rem;
    color: #fff;
  }
  .cover .subtitle {
    font-size: 1.15rem;
    font-weight: 300;
    color: rgba(255,255,255,0.65);
    max-width: 560px;
    margin-bottom: 3rem;
  }
  .cover .date { font-size: 0.85rem; color: rgba(255,255,255,0.35); }
  .cover .version {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    color: var(--gold);
    margin-top: 0.5rem;
    opacity: 0.7;
  }

  /* Content */
  .content { max-width: 820px; margin: 0 auto; padding: 2.5rem 2rem; }

  h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--navy);
    margin-top: 2.5rem;
    margin-bottom: 0.8rem;
    padding-bottom: 0.4rem;
    border-bottom: 2px solid var(--gold-pale);
  }
  h2:first-child { margin-top: 0; }

  h3 {
    font-size: 1.05rem;
    font-weight: 600;
    color: var(--dark);
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  h4 {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--navy);
    margin-top: 1rem;
    margin-bottom: 0.3rem;
  }

  p { margin-bottom: 0.6rem; color: #374151; font-size: 0.88rem; }
  strong { font-weight: 600; }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 0.75rem 0;
    font-size: 0.8rem;
  }
  thead th {
    background: var(--light-gray);
    font-weight: 600;
    text-align: left;
    padding: 0.5rem 0.6rem;
    border-bottom: 2px solid var(--border);
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--gray);
  }
  tbody td {
    padding: 0.45rem 0.6rem;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
  }
  tbody tr:last-child td { border-bottom: none; }
  .positive { color: var(--green); font-weight: 600; }

  /* Code blocks */
  code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem;
    background: #f1f5f9;
    padding: 1px 5px;
    border-radius: 3px;
    color: var(--navy);
  }
  .code-block {
    background: var(--code-bg);
    border-radius: 8px;
    padding: 1rem 1.25rem;
    margin: 0.75rem 0;
    overflow-x: auto;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    line-height: 1.5;
    color: #e2e8f0;
  }
  .code-block .comment { color: #64748b; }
  .code-block .keyword { color: #c084fc; }
  .code-block .string { color: #86efac; }
  .code-block .arrow { color: var(--gold); }

  /* Architecture boxes */
  .arch-flow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    margin: 1.25rem 0;
    flex-wrap: wrap;
  }
  .arch-box {
    background: linear-gradient(135deg, #eff6ff, #dbeafe);
    border: 1px solid #93c5fd;
    border-radius: 8px;
    padding: 0.4rem 0.8rem;
    font-size: 0.72rem;
    font-weight: 600;
    color: var(--navy);
    text-align: center;
  }
  .arch-box small { font-weight: 400; color: var(--gray); display: block; font-size: 0.65rem; }
  .arch-arrow { color: var(--gold); font-size: 1.1rem; }

  /* Callouts */
  .callout {
    background: linear-gradient(135deg, #eff6ff, #f0f9ff);
    border-left: 4px solid var(--navy);
    border-radius: 0 8px 8px 0;
    padding: 1rem 1.25rem;
    margin: 1.25rem 0;
  }
  .callout p { margin: 0; font-size: 0.85rem; }
  .callout strong { color: var(--navy); }

  .callout-gold {
    background: linear-gradient(135deg, #fef3c7, #fffbeb);
    border-left-color: var(--gold);
  }
  .callout-gold strong { color: #92400e; }

  /* Feature grid */
  .feature-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin: 1rem 0;
  }
  .feature-card {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1rem;
    border-left: 3px solid var(--navy);
  }
  .feature-card h4 {
    font-size: 0.85rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
    margin-top: 0;
    color: var(--dark);
  }
  .feature-card p {
    font-size: 0.78rem;
    margin-bottom: 0;
    color: var(--gray);
  }

  /* Two columns */
  .two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin: 0.75rem 0;
  }

  /* Stats row */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.75rem;
    margin: 1rem 0;
  }
  .stat-box {
    background: var(--light-gray);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 0.75rem;
    text-align: center;
  }
  .stat-box .value {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--navy);
  }
  .stat-box .value.gold { color: var(--gold); }
  .stat-box .label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--gray);
    margin-top: 0.2rem;
  }

  ul { padding-left: 1.2rem; margin-bottom: 0.6rem; }
  li { font-size: 0.82rem; color: #374151; margin-bottom: 0.25rem; }

  /* Schema diagram styling */
  .schema-section {
    background: var(--light-gray);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1rem;
    margin: 0.75rem 0;
  }
  .schema-section h4 {
    color: var(--navy);
    font-size: 0.85rem;
    margin-top: 0;
    margin-bottom: 0.5rem;
    padding-bottom: 0.3rem;
    border-bottom: 1px solid var(--border);
  }
  .schema-cols {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.25rem 1.5rem;
    font-size: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
  }
  .schema-cols .col-name { color: var(--dark); }
  .schema-cols .col-type { color: var(--gray); font-size: 0.7rem; }

  /* Footer */
  .footer {
    text-align: center;
    padding: 1.5rem;
    font-size: 0.68rem;
    color: var(--gray);
    border-top: 1px solid var(--border);
    margin-top: 2rem;
  }
  .footer strong { color: var(--navy); }

  /* TOC */
  .toc { margin: 1.5rem 0; }
  .toc-item {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 0.3rem 0;
    border-bottom: 1px dotted var(--border);
    font-size: 0.88rem;
  }
  .toc-item .toc-title { font-weight: 500; color: var(--dark); }
  .toc-item .toc-page { color: var(--gray); font-size: 0.8rem; }
  .toc-section {
    font-weight: 700;
    color: var(--navy);
    font-size: 0.9rem;
    padding-top: 0.5rem;
    border-bottom: none;
  }
</style>
</head>
<body>

<!-- COVER -->
<div class="cover">
  <div class="cover-corners"></div>
  <div class="cover-corners-bottom"></div>
  <div class="doc-type">Technical Architecture Document</div>
  <div class="logo" style="margin-bottom: 2.5rem;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 260 60" width="220" height="51">
      <defs><linearGradient id="bg-cover" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#172554"/><stop offset="100%" stop-color="#1e3a5f"/></linearGradient></defs>
      <circle cx="30" cy="30" r="28" fill="url(#bg-cover)"/>
      <rect x="20.04" y="38.4" width="17.92" height="8.4" rx="1.68" ry="1.68" fill="#ffffff" opacity="0.2"/>
      <rect x="24.4" y="28.88" width="11.2" height="9.52" rx="1.4" ry="1.4" fill="#ffffff" opacity="0.35"/>
      <rect x="26.92" y="18.8" width="6.16" height="10.08" rx="1.12" ry="1.12" fill="#ffffff" opacity="0.5"/>
      <line x1="21.6" y1="41.2" x2="38.4" y2="41.2" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
      <line x1="21.6" y1="44" x2="38.4" y2="44" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
      <line x1="24.96" y1="32.05" x2="35.04" y2="32.05" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
      <line x1="24.96" y1="35.22" x2="35.04" y2="35.22" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
      <line x1="27.48" y1="22.16" x2="32.52" y2="22.16" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
      <line x1="27.48" y1="25.52" x2="32.52" y2="25.52" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
      <path d="M 20.04 40.08 A 1.68 1.68 0 0 1 22.72 38.4 L 37.28 38.4 A 1.68 1.68 0 0 1 38.96 40.08" fill="none" stroke="#f59e0b" stroke-width="0.34" opacity="0.5"/>
      <path d="M 24.4 30.28 A 1.4 1.4 0 0 1 25.8 28.88 L 34.2 28.88 A 1.4 1.4 0 0 1 35.6 30.28" fill="none" stroke="#f59e0b" stroke-width="0.34" opacity="0.5"/>
      <path d="M 26.92 19.92 A 1.12 1.12 0 0 1 27.92 18.8 L 32.08 18.8 A 1.12 1.12 0 0 1 33.08 19.92" fill="none" stroke="#f59e0b" stroke-width="0.34" opacity="0.5"/>
      <line x1="30" y1="18.8" x2="30" y2="13.2" stroke="#ffffff" stroke-width="0.67" stroke-linecap="round"/>
      <path d="M 28.35 10.94 A 2.8 2.8 0 0 1 31.65 10.94" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="1"/>
      <path d="M 31.65 15.46 A 2.8 2.8 0 0 1 28.35 15.46" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="1"/>
      <path d="M 26.71 8.67 A 5.6 5.6 0 0 1 33.29 8.67" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="0.72"/>
      <path d="M 33.29 17.73 A 5.6 5.6 0 0 1 26.71 17.73" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="0.72"/>
      <path d="M 25.06 6.41 A 8.4 8.4 0 0 1 34.94 6.41" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="0.44"/>
      <path d="M 34.94 19.99 A 8.4 8.4 0 0 1 25.06 19.99" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="0.44"/>
      <circle cx="30" cy="13.2" r="1.01" fill="#f59e0b"/>
      <text x="68" y="38" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="30" font-weight="700" letter-spacing="-0.5" fill="#ffffff">RigaCap</text>
    </svg>
  </div>
  <h1>System Architecture<br>&amp; Technical Audit</h1>
  <p class="subtitle">
    Comprehensive technical documentation covering infrastructure, database schema,
    API surface, security architecture, deployment pipeline, and operational characteristics.
  </p>
  <div class="date">Confidential &mdash; February 2026</div>
  <div class="version">v2.5.0 &middot; 95 endpoints &middot; 18 tables &middot; 15K+ LOC</div>
</div>

<!-- TABLE OF CONTENTS -->
<div class="content page-break">
  <h2 style="margin-top:0;">Table of Contents</h2>
  <div class="toc">
    <div class="toc-item toc-section"><span class="toc-title">Infrastructure</span></div>
    <div class="toc-item"><span class="toc-title">1. System Overview &amp; Architecture</span><span class="toc-page">3</span></div>
    <div class="toc-item"><span class="toc-title">2. AWS Infrastructure (Terraform)</span><span class="toc-page">3</span></div>
    <div class="toc-item"><span class="toc-title">3. CDN, DNS &amp; SSL</span><span class="toc-page">4</span></div>

    <div class="toc-item toc-section"><span class="toc-title">Data Layer</span></div>
    <div class="toc-item"><span class="toc-title">4. Database Schema (PostgreSQL 15)</span><span class="toc-page">5</span></div>
    <div class="toc-item"><span class="toc-title">5. Data Pipeline &amp; Caching</span><span class="toc-page">7</span></div>

    <div class="toc-item toc-section"><span class="toc-title">Application</span></div>
    <div class="toc-item"><span class="toc-title">6. Backend Services (FastAPI)</span><span class="toc-page">8</span></div>
    <div class="toc-item"><span class="toc-title">7. API Surface (95 Endpoints)</span><span class="toc-page">9</span></div>
    <div class="toc-item"><span class="toc-title">8. Frontend Architecture (React)</span><span class="toc-page">11</span></div>

    <div class="toc-item toc-section"><span class="toc-title">Operations</span></div>
    <div class="toc-item"><span class="toc-title">9. Security Architecture</span><span class="toc-page">12</span></div>
    <div class="toc-item"><span class="toc-title">10. CI/CD Pipeline</span><span class="toc-page">13</span></div>
    <div class="toc-item"><span class="toc-title">11. Monitoring &amp; Performance</span><span class="toc-page">14</span></div>
    <div class="toc-item"><span class="toc-title">12. Dependencies &amp; Versions</span><span class="toc-page">14</span></div>
  </div>

  <div class="stats-row" style="margin-top: 2rem;">
    <div class="stat-box">
      <div class="value gold">95</div>
      <div class="label">API Endpoints</div>
    </div>
    <div class="stat-box">
      <div class="value gold">18</div>
      <div class="label">DB Tables</div>
    </div>
    <div class="stat-box">
      <div class="value gold">22+</div>
      <div class="label">Backend Services</div>
    </div>
    <div class="stat-box">
      <div class="value gold">15K+</div>
      <div class="label">Lines of Code</div>
    </div>
  </div>
</div>

<!-- PAGE: SYSTEM OVERVIEW -->
<div class="content page-break">
  <h2>1. System Overview</h2>
  <p>
    RigaCap is a serverless, event-driven trading platform built on AWS. The system ingests market data from
    6,500+ US equities, generates AI-powered trading signals, and delivers them to subscribers via a
    React dashboard and automated email pipeline. The entire backend runs on a single AWS Lambda function
    using FastAPI + Mangum for ASGI compatibility.
  </p>

  <div class="arch-flow no-break">
    <div class="arch-box">React 18 SPA<br><small>Vite + Tailwind</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">CloudFront<br><small>Edge CDN</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">API Gateway<br><small>HTTP/2</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">Lambda<br><small>FastAPI 6GB</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">RDS + S3<br><small>Postgres + Parquet</small></div>
  </div>

  <div class="arch-flow no-break" style="margin-top: 0;">
    <div class="arch-box">EventBridge<br><small>Cron triggers</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">Lambda</div>
    <div class="arch-arrow">&larr;</div>
    <div class="arch-box">Step Functions<br><small>Walk-forward</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">Claude API<br><small>AI optimization</small></div>
  </div>

  <h2>2. AWS Infrastructure</h2>
  <p>All infrastructure is managed via Terraform (<code>infrastructure/terraform/main.tf</code>). Resources are deployed in <code>us-east-1</code>.</p>

  <h3>Compute</h3>
  <table>
    <thead>
      <tr><th>Resource</th><th>Type</th><th>Configuration</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Lambda Function</strong></td>
        <td><code>rigacap-prod-api</code></td>
        <td>Container image (ECR), 6GB RAM, 900s timeout, VPC-attached</td>
      </tr>
      <tr>
        <td><strong>API Gateway</strong></td>
        <td>HTTP API (v2)</td>
        <td>Custom domain: <code>api.rigacap.com</code>, CORS configured, HTTP/2</td>
      </tr>
      <tr>
        <td><strong>ECR Repository</strong></td>
        <td><code>rigacap-prod-api</code></td>
        <td>Mutable tags, scan-on-push, keep last 5 images</td>
      </tr>
      <tr>
        <td><strong>Step Functions</strong></td>
        <td><code>rigacap-prod-walk-forward</code></td>
        <td>Orchestrates Lambda for multi-period walk-forward simulations</td>
      </tr>
    </tbody>
  </table>

  <h3>Storage</h3>
  <table>
    <thead>
      <tr><th>Bucket</th><th>Access</th><th>Purpose</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><code>rigacap-prod-frontend-*</code></td>
        <td>Public (CloudFront origin)</td>
        <td>React SPA static files (~1-2MB)</td>
      </tr>
      <tr>
        <td><code>rigacap-prod-price-data-*</code></td>
        <td>Private (Lambda IAM only)</td>
        <td>Parquet price cache, chart cards, social images (50-100MB)</td>
      </tr>
    </tbody>
  </table>

  <h3>Database</h3>
  <table>
    <thead>
      <tr><th>Resource</th><th>Configuration</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>RDS PostgreSQL 15</strong></td>
        <td><code>db.t3.micro</code>, 20GB gp2, deletion protection enabled, asyncpg driver</td>
      </tr>
      <tr>
        <td><strong>Connection Pool</strong></td>
        <td>Pool size: 5, max overflow: 10, connect timeout: 3s, query timeout: 5s</td>
      </tr>
    </tbody>
  </table>

  <h3>Scheduled Events (EventBridge)</h3>
  <table>
    <thead>
      <tr><th>Rule</th><th>Schedule</th><th>Target</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Market Scanner</strong></td>
        <td><code>cron(0 21 ? * MON-FRI *)</code> (4 PM ET)</td>
        <td>Lambda &rarr; <code>/api/signals/scan</code></td>
      </tr>
      <tr>
        <td><strong>Lambda Warmer</strong></td>
        <td><code>rate(5 minutes)</code></td>
        <td>Lambda &rarr; <code>/health</code></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- PAGE: CDN & DNS -->
<div class="content page-break">
  <h2>3. CDN, DNS &amp; SSL</h2>

  <h3>CloudFront Distribution</h3>
  <table>
    <thead>
      <tr><th>Setting</th><th>Value</th></tr>
    </thead>
    <tbody>
      <tr><td>Domains</td><td><code>rigacap.com</code>, <code>www.rigacap.com</code></td></tr>
      <tr><td>Origin</td><td>S3 website endpoint (HTTP-only)</td></tr>
      <tr><td>Protocol</td><td>Redirect HTTP &rarr; HTTPS</td></tr>
      <tr><td>Price Class</td><td>PriceClass_100 (US, Canada, Europe)</td></tr>
      <tr><td>Default TTL</td><td>1 hour (max 1 day)</td></tr>
      <tr><td>SPA Routing</td><td>Custom error: 404 &rarr; <code>/index.html</code> (200)</td></tr>
      <tr><td>SSL Certificate</td><td>ACM: <code>rigacap.com</code> + <code>*.rigacap.com</code> (DNS validated)</td></tr>
    </tbody>
  </table>

  <h3>Route53 DNS</h3>
  <table>
    <thead>
      <tr><th>Record</th><th>Type</th><th>Target</th></tr>
    </thead>
    <tbody>
      <tr><td><code>rigacap.com</code></td><td>A (alias)</td><td>CloudFront distribution</td></tr>
      <tr><td><code>www.rigacap.com</code></td><td>A (alias)</td><td>CloudFront distribution</td></tr>
      <tr><td><code>api.rigacap.com</code></td><td>A (alias)</td><td>API Gateway custom domain</td></tr>
    </tbody>
  </table>

  <h2>4. Database Schema</h2>
  <p>PostgreSQL 15 with async driver (<code>asyncpg</code>) via SQLAlchemy 2.0 async sessions. All tables use auto-increment integer primary keys except <code>users</code> and <code>subscriptions</code> (UUID).</p>

  <h3>Core Data Tables</h3>

  <div class="schema-section no-break">
    <h4>stock_data</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Daily OHLCV price data with computed indicators. One row per symbol per trading day.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">symbol</span> <span class="col-type">VARCHAR(10) IDX</span></div>
      <div><span class="col-name">date</span> <span class="col-type">DATETIME IDX</span></div>
      <div><span class="col-name">open, high, low, close</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">volume</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">dwap, ma_50, ma_200</span> <span class="col-type">FLOAT</span></div>
    </div>
  </div>

  <div class="schema-section no-break">
    <h4>signals</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Trading signals generated by the scanner. Status lifecycle: active &rarr; executed/expired.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">symbol</span> <span class="col-type">VARCHAR(10) IDX</span></div>
      <div><span class="col-name">signal_type</span> <span class="col-type">VARCHAR(10) BUY/SELL</span></div>
      <div><span class="col-name">price, dwap, pct_above_dwap</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">volume, volume_ratio</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">stop_loss, profit_target</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">is_strong</span> <span class="col-type">BOOLEAN</span></div>
      <div><span class="col-name">status</span> <span class="col-type">VARCHAR(20)</span></div>
      <div><span class="col-name">created_at, expires_at</span> <span class="col-type">DATETIME</span></div>
    </div>
  </div>

  <div class="schema-section no-break">
    <h4>positions</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Open/closed portfolio positions with trailing stop tracking.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">user_id</span> <span class="col-type">UUID FK&rarr;users</span></div>
      <div><span class="col-name">symbol</span> <span class="col-type">VARCHAR(10) IDX</span></div>
      <div><span class="col-name">entry_date, entry_price</span> <span class="col-type">DATETIME, FLOAT</span></div>
      <div><span class="col-name">shares, stop_loss</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">profit_target, highest_price</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">signal_id</span> <span class="col-type">INTEGER FK&rarr;signals</span></div>
      <div><span class="col-name">status</span> <span class="col-type">VARCHAR(20) open/closed</span></div>
    </div>
  </div>

  <div class="schema-section no-break">
    <h4>trades</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Completed trade records with P&amp;L tracking.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">user_id</span> <span class="col-type">UUID FK&rarr;users</span></div>
      <div><span class="col-name">position_id</span> <span class="col-type">INTEGER FK&rarr;positions</span></div>
      <div><span class="col-name">symbol</span> <span class="col-type">VARCHAR(10) IDX</span></div>
      <div><span class="col-name">entry_date, exit_date</span> <span class="col-type">DATETIME</span></div>
      <div><span class="col-name">entry_price, exit_price</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">pnl, pnl_pct</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">exit_reason</span> <span class="col-type">VARCHAR(50)</span></div>
    </div>
  </div>
</div>

<!-- PAGE: MORE SCHEMA -->
<div class="content page-break">
  <h3>Authentication &amp; Subscriptions</h3>

  <div class="schema-section no-break">
    <h4>users</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">User accounts with multi-provider OAuth support. UUID primary keys.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">UUID PK</span></div>
      <div><span class="col-name">email</span> <span class="col-type">VARCHAR(255) UNIQUE IDX</span></div>
      <div><span class="col-name">password_hash</span> <span class="col-type">VARCHAR(255) NULLABLE</span></div>
      <div><span class="col-name">name</span> <span class="col-type">VARCHAR(255)</span></div>
      <div><span class="col-name">role</span> <span class="col-type">VARCHAR(20) admin/user</span></div>
      <div><span class="col-name">google_id, apple_id</span> <span class="col-type">VARCHAR(255) UNIQUE</span></div>
      <div><span class="col-name">stripe_customer_id</span> <span class="col-type">VARCHAR(255) UNIQUE</span></div>
      <div><span class="col-name">is_active</span> <span class="col-type">BOOLEAN</span></div>
      <div><span class="col-name">created_at, last_login</span> <span class="col-type">DATETIME</span></div>
    </div>
  </div>

  <div class="schema-section no-break">
    <h4>subscriptions</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Stripe-managed subscription state. Status: trial/active/canceled/expired/past_due.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">UUID PK</span></div>
      <div><span class="col-name">user_id</span> <span class="col-type">UUID FK&rarr;users UNIQUE</span></div>
      <div><span class="col-name">status</span> <span class="col-type">VARCHAR(20)</span></div>
      <div><span class="col-name">stripe_subscription_id</span> <span class="col-type">VARCHAR(255)</span></div>
      <div><span class="col-name">stripe_price_id</span> <span class="col-type">VARCHAR(255)</span></div>
      <div><span class="col-name">trial_start, trial_end</span> <span class="col-type">DATETIME</span></div>
      <div><span class="col-name">current_period_start/end</span> <span class="col-type">DATETIME</span></div>
      <div><span class="col-name">cancel_at_period_end</span> <span class="col-type">BOOLEAN</span></div>
    </div>
  </div>

  <h3>Strategy Management</h3>

  <div class="schema-section no-break">
    <h4>strategy_definitions</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Trading strategy configurations. Types: dwap, momentum, ensemble.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">name</span> <span class="col-type">VARCHAR(100) UNIQUE</span></div>
      <div><span class="col-name">strategy_type</span> <span class="col-type">VARCHAR(50)</span></div>
      <div><span class="col-name">parameters</span> <span class="col-type">TEXT (JSON)</span></div>
      <div><span class="col-name">is_active</span> <span class="col-type">BOOLEAN IDX</span></div>
      <div><span class="col-name">source</span> <span class="col-type">VARCHAR(50) manual/ai</span></div>
      <div><span class="col-name">is_custom</span> <span class="col-type">BOOLEAN</span></div>
    </div>
  </div>

  <div class="two-col">
    <div class="schema-section no-break">
      <h4>strategy_evaluations</h4>
      <p style="font-size:0.7rem; color: var(--gray); margin-bottom: 0.3rem;">Performance evaluations for strategies</p>
      <div class="schema-cols" style="grid-template-columns: 1fr;">
        <div><span class="col-name">strategy_id</span> <span class="col-type">FK&rarr;strategy_definitions</span></div>
        <div><span class="col-name">total_return_pct, sharpe_ratio</span> <span class="col-type">FLOAT</span></div>
        <div><span class="col-name">max_drawdown_pct, win_rate</span> <span class="col-type">FLOAT</span></div>
        <div><span class="col-name">recommendation_score</span> <span class="col-type">FLOAT 0-100</span></div>
      </div>
    </div>
    <div class="schema-section no-break">
      <h4>strategy_switch_history</h4>
      <p style="font-size:0.7rem; color: var(--gray); margin-bottom: 0.3rem;">Audit trail for strategy switches</p>
      <div class="schema-cols" style="grid-template-columns: 1fr;">
        <div><span class="col-name">from/to_strategy_id</span> <span class="col-type">FK&rarr;strategy_definitions</span></div>
        <div><span class="col-name">trigger</span> <span class="col-type">manual/auto_scheduled</span></div>
        <div><span class="col-name">score_before, score_after</span> <span class="col-type">FLOAT</span></div>
        <div><span class="col-name">reason</span> <span class="col-type">TEXT</span></div>
      </div>
    </div>
  </div>

  <h3>Simulation &amp; Backtesting</h3>

  <div class="schema-section no-break">
    <h4>walk_forward_simulations</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Walk-forward simulation runs with aggregate results. Trades stored as JSON to avoid 256KB Step Functions state limit.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">start_date, end_date</span> <span class="col-type">DATETIME</span></div>
      <div><span class="col-name">reoptimization_frequency</span> <span class="col-type">VARCHAR(20)</span></div>
      <div><span class="col-name">total_return_pct, sharpe_ratio</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">max_drawdown_pct</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">trades_json</span> <span class="col-type">TEXT (JSON array)</span></div>
      <div><span class="col-name">equity_curve_json</span> <span class="col-type">TEXT (JSON)</span></div>
      <div><span class="col-name">status</span> <span class="col-type">pending/completed/failed</span></div>
      <div><span class="col-name">is_daily_cache</span> <span class="col-type">BOOLEAN IDX</span></div>
    </div>
  </div>

  <div class="schema-section no-break">
    <h4>social_posts</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">AI-generated social content with approval workflow. Status: draft &rarr; approved &rarr; scheduled &rarr; posted/canceled.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">post_type</span> <span class="col-type">trade_result/missed_opp/recap</span></div>
      <div><span class="col-name">platform</span> <span class="col-type">twitter/instagram</span></div>
      <div><span class="col-name">status</span> <span class="col-type">VARCHAR(20)</span></div>
      <div><span class="col-name">text_content, hashtags</span> <span class="col-type">TEXT</span></div>
      <div><span class="col-name">image_s3_key</span> <span class="col-type">VARCHAR(500)</span></div>
      <div><span class="col-name">scheduled_for, posted_at</span> <span class="col-type">DATETIME</span></div>
      <div><span class="col-name">ai_generated</span> <span class="col-type">BOOLEAN</span></div>
      <div><span class="col-name">ai_model, ai_prompt_hash</span> <span class="col-type">VARCHAR</span></div>
      <div><span class="col-name">news_context_json</span> <span class="col-type">TEXT</span></div>
      <div><span class="col-name">source_trade_json</span> <span class="col-type">TEXT</span></div>
    </div>
  </div>

  <h3>Model Portfolio &amp; Intelligence Tables</h3>

  <div class="schema-section no-break">
    <h4>model_positions</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Model portfolio positions (live, walkforward, ghost variants). Tracks entry/exit with signal replay data.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">portfolio_type</span> <span class="col-type">VARCHAR(20) IDX</span></div>
      <div><span class="col-name">symbol</span> <span class="col-type">VARCHAR(10) IDX</span></div>
      <div><span class="col-name">entry_date, entry_price</span> <span class="col-type">DATETIME, FLOAT</span></div>
      <div><span class="col-name">shares, cost_basis</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">highest_price, exit_price</span> <span class="col-type">FLOAT</span></div>
      <div><span class="col-name">exit_reason, status</span> <span class="col-type">VARCHAR</span></div>
      <div><span class="col-name">signal_data_json</span> <span class="col-type">TEXT (JSON)</span></div>
      <div><span class="col-name">autopsy_json</span> <span class="col-type">TEXT (JSON) &mdash; AI trade post-mortem</span></div>
    </div>
  </div>

  <div class="schema-section no-break">
    <h4>regime_forecast_snapshots</h4>
    <p style="font-size:0.75rem; color: var(--gray); margin-bottom: 0.4rem;">Daily regime forecast persistence for historical accuracy tracking and heatmap visualization.</p>
    <div class="schema-cols">
      <div><span class="col-name">id</span> <span class="col-type">INTEGER PK</span></div>
      <div><span class="col-name">snapshot_date</span> <span class="col-type">DATETIME UNIQUE IDX</span></div>
      <div><span class="col-name">current_regime</span> <span class="col-type">VARCHAR(30)</span></div>
      <div><span class="col-name">probabilities_json</span> <span class="col-type">TEXT (JSON) &mdash; 7 regime probabilities</span></div>
      <div><span class="col-name">outlook</span> <span class="col-type">stable/deteriorating/improving</span></div>
      <div><span class="col-name">recommended_action</span> <span class="col-type">VARCHAR(30)</span></div>
      <div><span class="col-name">spy_close, vix_close</span> <span class="col-type">FLOAT</span></div>
    </div>
  </div>
</div>

<!-- PAGE: BACKEND SERVICES -->
<div class="content page-break">
  <h2>5. Data Pipeline &amp; Caching</h2>

  <div class="feature-grid no-break">
    <div class="feature-card" style="border-left-color: var(--gold);">
      <h4>yfinance Ingestion</h4>
      <p>Daily download of 252-day rolling OHLCV for 100+ symbols. Split/dividend adjusted. Free API, no key required.</p>
    </div>
    <div class="feature-card" style="border-left-color: var(--green);">
      <h4>S3 Parquet Cache</h4>
      <p>Price data persisted to S3 as parquet files. Lambda loads on startup via <code>/api/warmup</code> endpoint. 7-day TTL.</p>
    </div>
    <div class="feature-card" style="border-left-color: var(--navy);">
      <h4>In-Memory Cache</h4>
      <p>ScannerService maintains <code>data_cache: Dict[str, DataFrame]</code> in Lambda memory. 600-800MB typical footprint.</p>
    </div>
    <div class="feature-card" style="border-left-color: #8b5cf6;">
      <h4>CDN Pre-computation</h4>
      <p>Dashboard JSON exported to S3 daily. CloudFront serves with 1-hour TTL for zero-latency dashboard loads.</p>
    </div>
  </div>

  <h2>6. Backend Services</h2>
  <p>
    22+ singleton service classes comprising 15,000+ lines of Python. All services are instantiated at module level
    and imported globally. The Lambda function uses Mangum for ASGI-to-Lambda translation.
  </p>

  <table>
    <thead>
      <tr><th>Service</th><th>LOC</th><th>Responsibility</th></tr>
    </thead>
    <tbody>
      <tr><td><strong>ScannerService</strong></td><td>940</td><td>Market scan, signal generation, data cache management</td></tr>
      <tr><td><strong>BacktesterService</strong></td><td>1,255</td><td>Historical backtesting, portfolio simulation, performance metrics</td></tr>
      <tr><td><strong>WalkForwardService</strong></td><td>1,907</td><td>Step Functions orchestration, period-by-period evaluation, AI optimization</td></tr>
      <tr><td><strong>EmailService</strong></td><td>2,358</td><td>Subscriber emails: welcome, daily digest, sell alerts, password reset</td></tr>
      <tr><td><strong>SchedulerService</strong></td><td>1,454</td><td>APScheduler background jobs, nightly digest, social post scheduling</td></tr>
      <tr><td><strong>ModelPortfolioService</strong></td><td>1,200</td><td>Dual live/WF portfolio tracking, ghost portfolios, what-if calculator</td></tr>
      <tr><td><strong>MarketRegimeService</strong></td><td>882</td><td>7-regime market classification using SPY indicators</td></tr>
      <tr><td><strong>DataExportService</strong></td><td>827</td><td>S3 data export/import, CDN pre-computation, parquet persistence</td></tr>
      <tr><td><strong>SocialContentService</strong></td><td>759</td><td>Template-based post generation (fallback for AI service)</td></tr>
      <tr><td><strong>AutoSwitchService</strong></td><td>683</td><td>Automated strategy switching with scoring and cooldown</td></tr>
      <tr><td><strong>StockUniverseService</strong></td><td>461</td><td>Stock universe management, sector classification, ETF filtering</td></tr>
      <tr><td><strong>StrategyAnalyzerService</strong></td><td>437</td><td>Multi-strategy comparison and performance attribution</td></tr>
      <tr><td><strong>StrategyGeneratorService</strong></td><td>434</td><td>Optuna-based parameter optimization, AI strategy generation</td></tr>
      <tr><td><strong>ChartCardGenerator</strong></td><td>346</td><td>1080&times;1080 matplotlib chart cards with brand styling</td></tr>
      <tr><td><strong>PostSchedulerService</strong></td><td>292</td><td>Post scheduling, notification pipeline, cancel mechanism</td></tr>
      <tr><td><strong>AIContentService</strong></td><td>287</td><td>Claude API integration for AI-powered content generation</td></tr>
      <tr><td><strong>SocialPostingService</strong></td><td>285</td><td>Twitter API v2 + Instagram Graph API publishing</td></tr>
      <tr><td><strong>TradeAutopsyService</strong></td><td>175</td><td>Claude-powered forensic post-mortem analysis for closed trades</td></tr>
      <tr><td><strong>RegimeForecastService</strong></td><td>185</td><td>Daily regime forecast storage, accuracy tracking, heatmap data</td></tr>
    </tbody>
  </table>

  <div class="callout-gold callout">
    <p><strong>Lambda Cold Start Mitigation:</strong> Database connections are initialized lazily on first request
    (Lambda init has a 10-second timeout). An EventBridge rule pings <code>/health</code> every 5 minutes to keep
    the Lambda warm. Post-deploy, <code>/api/warmup</code> preloads S3 data into memory.</p>
  </div>
</div>

<!-- PAGE: API ENDPOINTS -->
<div class="content page-break">
  <h2>7. API Surface (95 Endpoints)</h2>

  <h3>Authentication (<code>/auth</code>) &mdash; 9 endpoints</h3>
  <table>
    <thead><tr><th>Method</th><th>Path</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>POST</code></td><td>/auth/register</td><td>Email/password signup with Turnstile verification</td></tr>
      <tr><td><code>POST</code></td><td>/auth/login</td><td>Email/password login, returns JWT access + refresh tokens</td></tr>
      <tr><td><code>POST</code></td><td>/auth/refresh</td><td>Refresh access token using refresh token</td></tr>
      <tr><td><code>GET</code></td><td>/auth/me</td><td>Current user profile</td></tr>
      <tr><td><code>POST</code></td><td>/auth/google</td><td>Google OAuth signup/login</td></tr>
      <tr><td><code>POST</code></td><td>/auth/apple</td><td>Apple Sign In signup/login</td></tr>
      <tr><td><code>POST</code></td><td>/auth/forgot-password</td><td>Send password reset email</td></tr>
      <tr><td><code>POST</code></td><td>/auth/reset-password</td><td>Reset password with secure token</td></tr>
      <tr><td><code>POST</code></td><td>/auth/logout</td><td>Invalidate current tokens</td></tr>
    </tbody>
  </table>

  <h3>Signals (<code>/signals</code>) &mdash; 14 endpoints</h3>
  <table>
    <thead><tr><th>Method</th><th>Path</th><th>Auth</th></tr></thead>
    <tbody>
      <tr><td><code>GET</code></td><td>/signals/scan</td><td>Subscriber (runs full market scan)</td></tr>
      <tr><td><code>GET</code></td><td>/signals/latest</td><td>Subscriber</td></tr>
      <tr><td><code>GET</code></td><td>/signals/dashboard</td><td>Subscriber (comprehensive data)</td></tr>
      <tr><td><code>GET</code></td><td>/signals/momentum-rankings</td><td>Subscriber</td></tr>
      <tr><td><code>GET</code></td><td>/signals/missed</td><td>Subscriber (missed opportunities)</td></tr>
      <tr><td><code>GET</code></td><td>/signals/double-signals</td><td>Subscriber (multi-confirmation)</td></tr>
      <tr><td><code>GET</code></td><td>/signals/watchlist</td><td>Subscriber</td></tr>
      <tr><td><code>GET</code></td><td>/signals/approaching-trigger</td><td>Subscriber</td></tr>
      <tr><td><code>GET</code></td><td>/signals/symbol/{symbol}</td><td>Subscriber</td></tr>
      <tr><td><code>GET</code></td><td>/signals/info/{symbol}</td><td>Subscriber</td></tr>
      <tr><td><code>GET</code></td><td>/signals/cdn-url</td><td>Subscriber</td></tr>
      <tr><td><code>GET</code></td><td>/signals/memory-scan</td><td>Subscriber</td></tr>
      <tr><td><code>POST</code></td><td>/signals/backfill</td><td>Admin</td></tr>
      <tr><td><code>GET</code></td><td>/signals/simulate-intraday-crossover</td><td>Admin</td></tr>
    </tbody>
  </table>

  <h3>Billing (<code>/billing</code>) &mdash; 5 endpoints</h3>
  <table>
    <thead><tr><th>Method</th><th>Path</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>POST</code></td><td>/billing/create-checkout</td><td>Create Stripe Checkout session (7-day trial, CC required)</td></tr>
      <tr><td><code>POST</code></td><td>/billing/portal</td><td>Create Stripe Customer Portal session</td></tr>
      <tr><td><code>GET</code></td><td>/billing/subscription</td><td>Get current subscription status</td></tr>
      <tr><td><code>POST</code></td><td>/billing/sync</td><td>Sync subscription state from Stripe</td></tr>
      <tr><td><code>POST</code></td><td>/billing/webhook</td><td>Stripe webhook receiver (signature verified)</td></tr>
    </tbody>
  </table>

  <h3>Social (<code>/social</code>) &mdash; 16 endpoints</h3>
  <table>
    <thead><tr><th>Method</th><th>Path</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>GET</code></td><td>/social/posts</td><td>List posts (filter by status, type, platform)</td></tr>
      <tr><td><code>POST</code></td><td>/social/posts/compose</td><td>Create new draft post</td></tr>
      <tr><td><code>POST</code></td><td>/social/posts/{id}/approve</td><td>Approve for publishing</td></tr>
      <tr><td><code>POST</code></td><td>/social/posts/{id}/reject</td><td>Reject with reason</td></tr>
      <tr><td><code>POST</code></td><td>/social/posts/{id}/publish</td><td>Publish immediately</td></tr>
      <tr><td><code>POST</code></td><td>/social/posts/{id}/schedule</td><td>Schedule for future date</td></tr>
      <tr><td><code>POST</code></td><td>/social/posts/{id}/cancel</td><td>Cancel scheduled post</td></tr>
      <tr><td><code>POST</code></td><td>/social/posts/{id}/regenerate-ai</td><td>Re-generate via Claude API</td></tr>
      <tr><td><code>POST</code></td><td>/social/posts/{id}/edit</td><td>Edit draft content</td></tr>
      <tr><td><code>DELETE</code></td><td>/social/posts/{id}</td><td>Delete draft</td></tr>
      <tr><td><code>GET</code></td><td>/social/posts/{id}/cancel-email</td><td>One-click cancel via JWT link</td></tr>
      <tr><td><code>POST</code></td><td>/social/generate-chart/{id}</td><td>Generate chart card image</td></tr>
      <tr><td><code>GET</code></td><td>/social/stats</td><td>Publishing statistics</td></tr>
    </tbody>
  </table>

  <h3>Admin (<code>/admin</code>) &mdash; 50+ endpoints</h3>
  <p>All admin endpoints require <code>role=admin</code> AND email in <code>ADMIN_EMAILS</code> allowlist. Categories include: strategy management (20+), user management (6), market regime analysis (4), walk-forward simulation (8), backtesting (2), data debugging (2), model portfolio (10), trade autopsies (2), ghost comparison (1), regime forecast (3), what-if calculator (1).</p>
</div>

<!-- PAGE: FRONTEND -->
<div class="content page-break">
  <h2>8. Frontend Architecture</h2>

  <div class="stats-row" style="grid-template-columns: repeat(3, 1fr);">
    <div class="stat-box">
      <div class="value" style="color: var(--navy);">React 18</div>
      <div class="label">UI Framework</div>
    </div>
    <div class="stat-box">
      <div class="value" style="color: var(--navy);">Vite 5</div>
      <div class="label">Build Tool</div>
    </div>
    <div class="stat-box">
      <div class="value" style="color: var(--navy);">Tailwind 3</div>
      <div class="label">CSS Framework</div>
    </div>
  </div>

  <h3>Component Architecture</h3>
  <table>
    <thead>
      <tr><th>Component</th><th>Size</th><th>Responsibility</th></tr>
    </thead>
    <tbody>
      <tr><td><strong>App.jsx</strong></td><td>171 KB</td><td>Main dashboard: portfolio, signals, charts, auth, time-travel (admin)</td></tr>
      <tr><td><strong>WalkForwardSimulator.jsx</strong></td><td>67 KB</td><td>Configure/run simulations, equity curves, trade analysis</td></tr>
      <tr><td><strong>SocialTab.jsx</strong></td><td>55 KB</td><td>Post queue, AI generation, scheduling, chart cards, publishing</td></tr>
      <tr><td><strong>FlexibleBacktest.jsx</strong></td><td>39 KB</td><td>Backtest config, strategy comparison, exit testing</td></tr>
      <tr><td><strong>AdminDashboard.jsx</strong></td><td>42 KB</td><td>Strategy/user management, model portfolio, ghost comparison, regime forecast, what-if calculator, trade autopsies</td></tr>
      <tr><td><strong>LandingPage.jsx</strong></td><td>30 KB</td><td>Marketing: hero, features, pricing, FAQ, social proof</td></tr>
      <tr><td><strong>StrategyEditor.jsx</strong></td><td>16 KB</td><td>Custom strategy creation and editing</td></tr>
      <tr><td><strong>AutoSwitchConfig.jsx</strong></td><td>15 KB</td><td>Auto-switch rule configuration</td></tr>
      <tr><td><strong>LoginModal.jsx</strong></td><td>14 KB</td><td>Multi-provider auth: email, Google, Apple, Turnstile</td></tr>
      <tr><td><strong>StrategyGenerator.jsx</strong></td><td>12 KB</td><td>AI strategy generation interface</td></tr>
      <tr><td><strong>LegalPages.jsx</strong></td><td>11 KB</td><td>Terms, Privacy Policy, Financial Disclaimer</td></tr>
      <tr><td><strong>PasswordReset.jsx</strong></td><td>9 KB</td><td>Forgot/reset password flow</td></tr>
      <tr><td><strong>SubscriptionBanner.jsx</strong></td><td>9 KB</td><td>Trial countdown, upgrade CTA</td></tr>
    </tbody>
  </table>

  <h3>Key Frontend Libraries</h3>
  <div class="two-col">
    <div>
      <ul>
        <li><strong>Recharts</strong> &mdash; Dashboard charts, equity curves</li>
        <li><strong>Axios</strong> &mdash; HTTP client with JWT interceptor</li>
        <li><strong>React Router v6</strong> &mdash; SPA routing</li>
        <li><strong>Lucide React</strong> &mdash; SVG icon library</li>
      </ul>
    </div>
    <div>
      <ul>
        <li><strong>react-hot-toast</strong> &mdash; Notification system</li>
        <li><strong>date-fns</strong> &mdash; Date formatting/manipulation</li>
        <li><strong>clsx</strong> &mdash; Conditional classname utility</li>
        <li><strong>Puppeteer</strong> &mdash; Headless browser (chart rendering)</li>
      </ul>
    </div>
  </div>

  <h2>9. Security Architecture</h2>

  <h3>Authentication Flow</h3>
  <div class="arch-flow no-break">
    <div class="arch-box">Login<br><small>Email/Google/Apple</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">Turnstile<br><small>Bot protection</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">JWT Issue<br><small>HS256, 15min</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">Bearer Token<br><small>Auth header</small></div>
    <div class="arch-arrow">&rarr;</div>
    <div class="arch-box">Role Check<br><small>admin/user</small></div>
  </div>

  <table>
    <thead>
      <tr><th>Layer</th><th>Implementation</th></tr>
    </thead>
    <tbody>
      <tr><td><strong>Password Hashing</strong></td><td>bcrypt via passlib (auto-configured cost factor)</td></tr>
      <tr><td><strong>JWT Tokens</strong></td><td>HS256, 15-min access / 7-day refresh, python-jose library</td></tr>
      <tr><td><strong>OAuth Validation</strong></td><td>Google: ID token sig via public keys. Apple: JWKS with 1hr cache</td></tr>
      <tr><td><strong>Bot Protection</strong></td><td>Cloudflare Turnstile on registration endpoint</td></tr>
      <tr><td><strong>CORS</strong></td><td>Whitelist: rigacap.com, www.rigacap.com, localhost dev ports</td></tr>
      <tr><td><strong>Admin Guard</strong></td><td>Role check + ADMIN_EMAILS allowlist (double enforcement)</td></tr>
      <tr><td><strong>Subscription Gate</strong></td><td><code>require_valid_subscription</code> dependency on signal endpoints</td></tr>
      <tr><td><strong>Payment Security</strong></td><td>Stripe Checkout (PCI DSS), webhook signature verification</td></tr>
      <tr><td><strong>S3 Access</strong></td><td>Price data bucket: all public access blocked, IAM-only</td></tr>
      <tr><td><strong>HTTPS</strong></td><td>ACM certificates, CloudFront redirect HTTP&rarr;HTTPS</td></tr>
      <tr><td><strong>Email Cancel Links</strong></td><td>JWT-signed one-click cancel URLs for social post management</td></tr>
    </tbody>
  </table>
</div>

<!-- PAGE: CI/CD & MONITORING -->
<div class="content page-break">
  <h2>10. CI/CD Pipeline</h2>
  <p>Fully automated deployment via GitHub Actions on push to <code>main</code>. Zero-downtime updates via Lambda container image swaps.</p>

  <div class="code-block">
    <span class="comment"># Trigger: push to main OR pull request to main</span><br>
    <br>
    <span class="keyword">Stage 1: Test</span><br>
    &nbsp;&nbsp;Backend: Python 3.11 <span class="arrow">&rarr;</span> pip install <span class="arrow">&rarr;</span> <span class="string">pytest -v</span><br>
    &nbsp;&nbsp;Frontend: Node 18 <span class="arrow">&rarr;</span> npm ci <span class="arrow">&rarr;</span> <span class="string">npm run lint</span> <span class="arrow">&rarr;</span> <span class="string">npm test</span><br>
    <br>
    <span class="keyword">Stage 2: Deploy</span> <span class="comment">(only on main push)</span><br>
    &nbsp;&nbsp;1. npm run build <span class="arrow">&rarr;</span> S3 sync <span class="arrow">&rarr;</span> CloudFront invalidation<br>
    &nbsp;&nbsp;2. Pre-deploy: export price data to S3<br>
    &nbsp;&nbsp;3. Docker build (linux/amd64, --provenance=false) <span class="arrow">&rarr;</span> ECR push<br>
    &nbsp;&nbsp;4. Lambda update-function-code <span class="arrow">&rarr;</span> new image<br>
    &nbsp;&nbsp;5. Post-deploy: /api/warmup (load S3 data into memory)<br>
  </div>

  <div class="callout">
    <p><strong>Critical Lambda Build Requirement:</strong> Docker BuildKit creates multi-platform manifests with attestations
    that Lambda rejects. All builds use <code>--provenance=false --sbom=false</code> flags for compatibility.</p>
  </div>

  <h2>11. Monitoring &amp; Performance</h2>

  <h3>Current Monitoring</h3>
  <table>
    <thead><tr><th>Component</th><th>Method</th><th>Retention</th></tr></thead>
    <tbody>
      <tr><td>Lambda Logs</td><td>CloudWatch (Python logging)</td><td>30 days</td></tr>
      <tr><td>API Gateway</td><td>CloudWatch metrics (4xx, 5xx)</td><td>14 days</td></tr>
      <tr><td>Step Functions</td><td>CloudWatch log group (ERROR level)</td><td>30 days</td></tr>
      <tr><td>Database</td><td>RDS console metrics</td><td>14 days</td></tr>
    </tbody>
  </table>

  <h3>Performance Characteristics</h3>
  <table>
    <thead><tr><th>Operation</th><th>Latency</th><th>Resource</th></tr></thead>
    <tbody>
      <tr><td>Dashboard load</td><td>&lt;2 seconds</td><td>Pre-computed JSON from CDN</td></tr>
      <tr><td>Signal scan (100+ symbols)</td><td>30&ndash;45 seconds</td><td>yfinance download + calculation</td></tr>
      <tr><td>Single backtest (90d, 100 symbols)</td><td>20&ndash;40 seconds</td><td>Lambda 6GB memory</td></tr>
      <tr><td>Walk-forward (5yr, 26 periods)</td><td>10&ndash;30 minutes</td><td>Step Functions &rarr; Lambda</td></tr>
      <tr><td>AI content generation</td><td>2&ndash;5 seconds</td><td>Claude API (Sonnet 4.5)</td></tr>
      <tr><td>Chart card generation</td><td>1&ndash;3 seconds</td><td>matplotlib (Lambda, 6GB)</td></tr>
    </tbody>
  </table>

  <h3>Resource Utilization</h3>
  <div class="stats-row">
    <div class="stat-box">
      <div class="value gold">6 GB</div>
      <div class="label">Lambda Memory</div>
    </div>
    <div class="stat-box">
      <div class="value gold">~800 MB</div>
      <div class="label">Typical Usage</div>
    </div>
    <div class="stat-box">
      <div class="value gold">20 GB</div>
      <div class="label">RDS Storage</div>
    </div>
    <div class="stat-box">
      <div class="value gold">~100 MB</div>
      <div class="label">S3 Price Data</div>
    </div>
  </div>

  <h2>12. Dependencies</h2>
  <div class="two-col">
    <div>
      <h3>Backend (Python 3.11)</h3>
      <ul>
        <li><strong>FastAPI</strong> 0.109.0 + Uvicorn 0.27.0</li>
        <li><strong>SQLAlchemy</strong> 2.0.25 + asyncpg 0.29.0</li>
        <li><strong>Pydantic</strong> 2.5.0</li>
        <li><strong>pandas</strong> 2.1.4 + numpy 1.26.3</li>
        <li><strong>yfinance</strong> &ge;1.1.0</li>
        <li><strong>Optuna</strong> &ge;3.5.0</li>
        <li><strong>matplotlib</strong> &ge;3.8.0</li>
        <li><strong>boto3</strong> 1.34.0 + Mangum 0.17.0</li>
        <li><strong>Stripe</strong> 7.10.0</li>
        <li><strong>python-jose</strong> 3.3.0 + passlib 1.7.4</li>
        <li><strong>APScheduler</strong> 3.10.4</li>
        <li><strong>httpx</strong> 0.26.0 (Claude API client)</li>
      </ul>
    </div>
    <div>
      <h3>Frontend (Node 18)</h3>
      <ul>
        <li><strong>React</strong> 18.2.0</li>
        <li><strong>Vite</strong> 5.0.0</li>
        <li><strong>TailwindCSS</strong> 3.3.5</li>
        <li><strong>React Router</strong> 6.20.0</li>
        <li><strong>Recharts</strong> 2.10.0</li>
        <li><strong>Axios</strong> 1.6.0</li>
        <li><strong>Lucide React</strong> 0.292.0</li>
        <li><strong>Puppeteer</strong> 24.37.3</li>
        <li><strong>ESLint</strong> 8.53.0</li>
        <li><strong>Vitest</strong> 0.34.6</li>
      </ul>
    </div>
  </div>

  <div class="footer">
    <div style="margin-bottom: 0.75rem;">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 260 60" width="130" height="30">
        <defs><linearGradient id="bg-footer" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#172554"/><stop offset="100%" stop-color="#1e3a5f"/></linearGradient></defs>
        <circle cx="30" cy="30" r="28" fill="url(#bg-footer)"/>
        <rect x="20.04" y="38.4" width="17.92" height="8.4" rx="1.68" ry="1.68" fill="#ffffff" opacity="0.2"/>
        <rect x="24.4" y="28.88" width="11.2" height="9.52" rx="1.4" ry="1.4" fill="#ffffff" opacity="0.35"/>
        <rect x="26.92" y="18.8" width="6.16" height="10.08" rx="1.12" ry="1.12" fill="#ffffff" opacity="0.5"/>
        <line x1="21.6" y1="41.2" x2="38.4" y2="41.2" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
        <line x1="21.6" y1="44" x2="38.4" y2="44" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
        <line x1="24.96" y1="32.05" x2="35.04" y2="32.05" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
        <line x1="24.96" y1="35.22" x2="35.04" y2="35.22" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
        <line x1="27.48" y1="22.16" x2="32.52" y2="22.16" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
        <line x1="27.48" y1="25.52" x2="32.52" y2="25.52" stroke="#f59e0b" stroke-width="0.22" opacity="0.35"/>
        <path d="M 20.04 40.08 A 1.68 1.68 0 0 1 22.72 38.4 L 37.28 38.4 A 1.68 1.68 0 0 1 38.96 40.08" fill="none" stroke="#f59e0b" stroke-width="0.34" opacity="0.5"/>
        <path d="M 24.4 30.28 A 1.4 1.4 0 0 1 25.8 28.88 L 34.2 28.88 A 1.4 1.4 0 0 1 35.6 30.28" fill="none" stroke="#f59e0b" stroke-width="0.34" opacity="0.5"/>
        <path d="M 26.92 19.92 A 1.12 1.12 0 0 1 27.92 18.8 L 32.08 18.8 A 1.12 1.12 0 0 1 33.08 19.92" fill="none" stroke="#f59e0b" stroke-width="0.34" opacity="0.5"/>
        <line x1="30" y1="18.8" x2="30" y2="13.2" stroke="#ffffff" stroke-width="0.67" stroke-linecap="round"/>
        <path d="M 28.35 10.94 A 2.8 2.8 0 0 1 31.65 10.94" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="1"/>
        <path d="M 31.65 15.46 A 2.8 2.8 0 0 1 28.35 15.46" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="1"/>
        <path d="M 26.71 8.67 A 5.6 5.6 0 0 1 33.29 8.67" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="0.72"/>
        <path d="M 33.29 17.73 A 5.6 5.6 0 0 1 26.71 17.73" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="0.72"/>
        <path d="M 25.06 6.41 A 8.4 8.4 0 0 1 34.94 6.41" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="0.44"/>
        <path d="M 34.94 19.99 A 8.4 8.4 0 0 1 25.06 19.99" fill="none" stroke="#f59e0b" stroke-width="0.56" stroke-linecap="round" opacity="0.44"/>
        <circle cx="30" cy="13.2" r="1.01" fill="#f59e0b"/>
        <text x="68" y="38" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="30" font-weight="700" letter-spacing="-0.5" fill="#0f172a">RigaCap</text>
      </svg>
    </div>
    <p>Technical Architecture Document &mdash; v2.4.0 &mdash; February 2026</p>
    <p style="margin-top: 0.5rem;">This document is confidential and intended solely for authorized technical reviewers.
    Infrastructure details should not be shared outside the organization.</p>
  </div>
</div>

</body>
</html>
